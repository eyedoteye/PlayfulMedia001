<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <title>EaselJS Experiment#001</title>
    <style>
      body { margin: 0; background: black }
      canvas { height: 99vh }
      #canvas-wrapper { width:100%; text-align: center }
    </style>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
    <script src="Tone.js"></script>
  </head>
  <body onload="init();">
    <script>
      function distance(x1, y1, x2, y2)
      {
        var xDiff = x2 - x1;
        var yDiff = y2 - y1;
        return Math.sqrt(xDiff * xDiff + yDiff * yDiff);
      }

      function scale(minInput, maxInput, curInput, minOutput, maxOutput)
      {
        var t = curInput != 0 ? (curInput - minInput)/(maxInput - minInput) : 0;
        t = t < 0 ? 0 : t;
        t = t > 1 ? 1 : t;
        t = t * (maxOutput - minOutput) + minOutput;
        return t;
      }
      
      function getFrequencyOfPositionInLinearRange(
        frequencyStart, frequencyEnd,
        rangeStartingPosition, rangeEndingPosition, 
        position)
      {
        let frequencyPosition = scale(rangeStartingPosition, rangeEndingPosition, position, frequencyStart, frequencyEnd);
        return frequencyPosition;
      }

      let _twelfthRootOfTwo = Math.pow(2, 1/12);
      function getNoteFrequency(A4Frequency, halfStepsFromA4)
      {
        // Formula info: http://www.phy.mtu.edu/~suits/NoteFreqCalcs.html
        let noteFrequency = A4Frequency * Math.pow(_twelfthRootOfTwo, halfStepsFromA4);
        return noteFrequency;
      }
      
      function gethalfStepsFromFrequency(A4Frequency, frequency)
      {
        if(frequency === 0)
          return 0;

        let halfStepsFromFrequency = Math.log(frequency / A4Frequency) / Math.log(_twelfthRootOfTwo);

        return halfStepsFromFrequency;
      }

      class LinearFrequencyArea
      {
        constructor(stage, canvas)
        {
          this.y = 0;
          this.frequencyStart = 0;
          this.frequencyEnd = 2;
          this.linkToStage = stage;
          this.background = new createjs.Shape();
          this.linkToStage.addChild(this.background);

          this.background.graphics.beginLinearGradientFill(
            ["black", "green"], [0.1,1],
            0, canvas.height,
            0, 0)
            .drawRect(
              0, 0,
              canvas.width, canvas.height)
          .endFill();
        }
      }

      class Note
      {
        constructor(noteAsString, halfStepsFromA4)
        {
          this.noteString = noteString;
          this.frequency = getNoteFrequency(halfStepsFromA4); 
        }

        getPosition()
        {
        }
      }
      
      function init()
      {
        let osc = new Tone.Oscillator(0, "sine").toMaster().start();

        let canvas = document.createElement("canvas");
        canvas.width = 360;
        canvas.height = 640;
        let wrapper = document.createElement("div");
        wrapper.id = "canvas-wrapper"
        wrapper.appendChild(canvas);
        document.body.appendChild(wrapper);

        let stage = new createjs.Stage(canvas);
        stage.height = 640;
        createjs.Touch.enable(stage);

        linearFrequencyArea = new LinearFrequencyArea(stage, canvas);

        var frequencyBall = new createjs.Shape();
        frequencyBall.baseRadius = 20;
        frequencyBall.radius = 20;
        frequencyBall.maxRadius = 50;
        frequencyBall.x = canvas.width / 2;
        frequencyBall.y = canvas.height - 35;
        stage.addChild(frequencyBall);

        frequencyBall.on("pressmove", function(e) {
          e.target.x = e.stageX;
          e.target.y = e.stageY;
        });

        frequencyBall.update = () =>
        {
          let radius = scale(0, stage.height, frequencyBall.y, frequencyBall.maxRadius, frequencyBall.baseRadius); 
          frequencyBall.radius = radius; 

          frequencyBall.graphics.clear();
          frequencyBall.graphics.beginFill("Green").drawCircle(0, 0, frequencyBall.radius);
        };

        function update()
        {
          frequencyBall.update();
          stage.update();
        }

        createjs.Ticker.setFPS(60);
        createjs.Ticker.addEventListener("tick", update);
     //     for(let i = 0; i < 12 * 8; i++)
     //     {
     //       constantFrequencyNote = createNote(i, freqMax, canvas.width);
     //       constantNotewidthNote = createNoteWithConstantWidth(i, freqMax, noteWidth);

     //       noteRight = scale(0, 1, t, constantFrequencyNote.position, constantNotewidthNote.right);

     //       background.graphics.beginStroke("white")
     //                            .moveTo(noteRight, 0).lineTo(noteRight, canvas.height)
     //                            .endStroke();
     //     }
     //   };

     //   circle.on("pressmove", function(e) {
     //     e.target.x = e.stageX;
     //     e.target.y = e.stageY;
     //     osc.frequency.value = getFrequencyFromPositionAndT(frequencyModeToggle.t, e.stageX, halfNoteStart, noteWidth);
     //     text.text = getFrequencyFromPositionAndT(frequencyModeToggle.t, circle.x, halfNoteStart, noteWidth);
     //     // osc.volume.value = scale(0, canvas.height, e.stageY, 0, -40);
     //   });
     //   
     //   stage.mouseMoveOutside = true;
     //   stage.on("stagemousemove", function(e) {
     //     var localMouseCoords = circle.globalToLocal(e.rawX, e.rawY);
     //     circle.alpha = scale(0, canvas.width * .85, distance(0,0,localMouseCoords.x, localMouseCoords.y), 1, 0);
     //   });

     //   function update(e)
     //   { 
     //     stage.update();
     //   }
     //   
     //   var halfNoteStart = 12 * 0;
     //   setBackground(background, frequencyModeToggle.t);
     //   setFrequencyMode(frequencyModeToggle.t);

     //   createjs.Ticker.setFPS(60);
     //   createjs.Ticker.addEventListener("tick", update);
      }
    </script>
  </body>
</html>
